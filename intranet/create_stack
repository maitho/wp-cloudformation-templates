ENV_FILE=$1
if [ -z "$ENV_FILE" ]; then 
  echo "USAGE: $0 <env file>"
fi
ENV=`basename $1`
ENV=${ENV%%.*} # strips the conf file name to remove everything after the first dot
STACK_NAME=mojintranet-$ENV-$(date +%s)
JSON_CONFIG_FILE=/tmp/$STACK_NAME

docker_env_file_to_cloudformation_params_file  $ENV_FILE >$JSON_CONFIG_FILE
aws cloudformation create-stack --template-body "file://$PWD/hosting.yaml" --parameters "file://$JSON_CONFIG_FILE" --stack-name $STACK_NAME --capabilities CAPABILITY_IAM
rm $JSON_CONFIG_FILE
